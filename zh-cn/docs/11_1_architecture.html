<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="11_1_architecture" />
	<meta name="description" content="11_1_architecture" />
	<!-- 网页标签标题 -->
	<title>11_1_architecture</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><span class="language-switch language-switch-normal">En</span><span class="github"><a title="Github" target="_blank" href="https://github.com/Bytom/bytom"><img src="/img/github.png" alt=""/></a></span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="//bytom.io" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="//bytom.io/dev" target="_self">开发者</a></li></ul></div></div></header><div style="background:url(/img/banner.png)  top center no-repeat" class="bar"><div class="bar-body"><p>比原链开发文档</p></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span></span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/01_bytom.html" target="_self">比原链</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/02_release.html" target="_self">版本计划</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/03_technology.html" target="_self">技术介绍</a></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>客户端<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/04_1_bytom.html" target="_self">Bytomd</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/04_2_simd.html" target="_self">Simd</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/04_3_spv.html" target="_self">SPV</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/04_4_vapor.html" target="_self">Vapor</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/04_5_gm.html" target="_self">GM</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/05_compile.html" target="_self">编译钱包</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/06_network.html" target="_self">网络</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/07_dashboard.html" target="_self">仪表盘</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/08_cli_guide.html" target="_self">钱包命令</a></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>挖矿<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/09_1_tensority.html" target="_self">Tensority算法</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/09_2_cpu.html" target="_self">CPU挖矿</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/09_3_gpu.html" target="_self">GPU挖矿</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/09_4_asic.html" target="_self">ASIC矿机</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/09_5_mining_pools.html" target="_self">矿池挖矿</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>工具<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10_1_blockmeta.html" target="_self">Blockmeta</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10_2_bytom_kit.html" target="_self">Bytom Kit</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10_3_byone.html" target="_self">Byone</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10_4_bytom_spanner.html" target="_self">Bytom Spanner</a></li></ul></li><li style="height:252px;overflow:hidden" class="menu-item menu-item-level-2"><span>开发指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/11_1_architecture.html" target="_self">系统架构</a></li><li class="menu-item menu-item-level-3"><a target="_self">交易说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/11_3_mnemonic.html" target="_self">助记词</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/11_4_websocket.html" target="_self">Websocket调用节点</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/11_5_json_rpc.html" target="_self">JSON-RPC调用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/11_6_sdk.html" target="_self">SDK介绍</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>智能合约<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/12_1_equity.html" target="_self">智能合约</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/12_2_smart_contract_build.html" target="_self">智能合约构建</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/12_3_contract_template.html" target="_self">智能合约模板</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/12_4_contract_operator.html" target="_self">智能合约操作码</a></li></ul></li><li style="height:72px;overflow:hidden" class="menu-item menu-item-level-2"><span>对接指南<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/13_1_mining_pool_docking_guide.html" target="_self">矿池对接文档</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>术语表<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/14_1_transaction.html" target="_self">交易</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/14_2_address.html" target="_self">地址</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/14_3_account.html" target="_self">账户</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/14_4_block.html" target="_self">区块</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/15_error_code.html" target="_self">错误码</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/16_faq.html" target="_self">常见问题</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/17_community.html" target="_self">社区</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>系统架构</h1>
<p><a name="cd4cb607"></a>
<img src="https://cdn.nlark.com/yuque/0/2019/png/241708/1554863983289-0450c0fe-284d-4fcd-b4aa-723096100c7e.png#align=left&amp;display=inline&amp;height=479&amp;originHeight=876&amp;originWidth=1364&amp;status=done&amp;width=746" alt=""></p>
  <br />
<p>比原链分为三个层次 第一层就是大家接触比较多的钱包层，就是进行收款和打款的模块，钱包一般带操作界面，大家都可以日常使用，所以会比较熟悉。 然后就是最核心的内核层，内核可以理解为分布式系统中每个节点认同的一套规则，只有有相同的规则，两个节点才能达成一致。如果规则不同，其实就是发生分叉了。 最后一层是通信层，通信层是节点之间交换信息的方式，包含区块同步，交易同步等。</p>
<p><a name="c54eb9d4"></a></p>
<h2>内核层</h2>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/241708/1554863985554-186145fb-44b7-43af-bec9-d7ad5aa317e3.png#align=left&amp;display=inline&amp;height=477&amp;originHeight=871&amp;originWidth=1361&amp;size=0&amp;status=done&amp;width=746" alt=""></p>
<p>首先来看内核层，内核层主要由五个模块构成：</p>
<ul>
<li>孤儿块管理：孤儿块就是由矿工挖出但未成为主链区块的区块（在相同高度产生2个甚至更多的合法区块，一个区块成为主链，剩下的则称为孤儿块），孤儿块管理就是将未成为主链区块的孤儿块存储起来。</li>
<li>共识层：确认一个块是否合法。分为区块头验证和交易验证。区块头验证需要验证它的父块和时间戳，同是需要算力来保证记账权利。交易验证比原特别的设计了一层BC层，这层在交易验证时会获得更好的性能，交易验证还和智能合约相关，交易被验证时参数会参入虚拟机验证该交易是否合法。</li>
<li>区块树管理：又成为Block Index，作用是记录全网所有的块，保存了全网所有块的一张镜像图。因为有孤儿块，所有它并不是链式结构的，会有分叉的情况，所以称为区块树</li>
<li>数据存储：将区块数据做持久化存储。包含两种数据，第一种是区块数据，会在网络上进行广播的原生区块信息；第二种是UTXO数据，存储UTXO数据是为了更快的验证一笔UTXO是否可以花费，而不需要去遍历所有区块信息</li>
<li>交易池：维护了所有全网发出的但是还未被确认的交易。跟它关联最大的是挖矿模块，挖矿模块每次要产生一个新区块的时候，它会从交易池拿一些交易打包成块，然后用Tensority共识算法进行工作量验算</li>
</ul>
<p><a name="97fb8a90"></a></p>
<h2>钱包层</h2>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/241708/1554863983212-bde29893-f883-4a9d-92ca-587728d5af78.png#align=left&amp;display=inline&amp;height=464&amp;originHeight=844&amp;originWidth=1357&amp;size=0&amp;status=done&amp;width=746" alt=""></p>
<p>然后来说一下钱包层：</p>
<ul>
<li>私钥模块：主要用于管理私钥（私钥的生成，存储，备份等）和签名</li>
<li>账户模块：在比原的设计中，使用了账户-地址-密钥三层体系，每个人可以拥有多把私钥，通过私钥不同的组合形式形成账户，每个账户可以又无限多个地址，地址是由账户的私钥派生出的二级私钥形成的地址，使用多地址可以更好的保护用户的隐私。</li>
<li>资产模块：管理账户下创建资产的模块，任何issue的资产都是在这个模块中交互。</li>
<li>交易模块：可以理解成跟我相关的交易数据，它主要做了两件事：
<ul>
<li>将和你相关的交易从所有交易中筛选出来</li>
<li>维护钱包层UTXO的数据库，记录本人所拥有的UTXO</li>
</ul>
</li>
</ul>
<p><a name="b5d1bd6e"></a></p>
<h2>通讯层</h2>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/241708/1554863982912-5f15d2c7-17d6-47e1-83a8-bd8ecbca0fac.png#align=left&amp;display=inline&amp;height=486&amp;originHeight=875&amp;originWidth=1343&amp;size=0&amp;status=done&amp;width=746" alt=""></p>
<p>最后说一下通讯层：</p>
<ul>
<li>节点发现：P2P相关，是非常独立和成熟的一块，通过节点发现这个模块获得种子节点，然后通过种子节点来获取其他更多的节点。</li>
<li>交易同步：在各个节点之间同步交易。</li>
<li>区块同步：又称为被动区块同步，如果发现存在区块高度高于自己的其他节点时，不断请求区块同步。</li>
<li>新区块快速广播模块：新区块主动同步，当挖到一个新的区块时进行强制广播，从而更快的在全网传播。</li>
</ul>
</div></section><footer class="footer-container"><div class="footer-body"><div class="copyright"><span>Copyright © 2019 Bytom</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>