<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="13_1_mining_pool_docking_guide" />
	<meta name="description" content="13_1_mining_pool_docking_guide" />
	<!-- 网页标签标题 -->
	<title>Mining Pool</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><span class="langHover"></span><span class="lang"><img src="/img/lang.png" alt=""/></span><span class="github"><a title="Github" target="_blank" href="https://github.com/Bytom/bytom"><img src="/img/github.png" alt=""/></a></span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/dev" target="_self">Developer</a></li></ul></div></div></header><div style="background:url(/img/banner.png)  top center no-repeat" class="bar"><div class="bar-body"><p>Bytom Dev Document</p></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span></span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/01_bytom.html" target="_self">Bytom</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/02_release.html" target="_self">Release</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/03_technology.html" target="_self">Technology</a></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>Client<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/04_1_bytom.html" target="_self">Bytom</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/04_2_simd.html" target="_self">Simd</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/04_3_spv.html" target="_self">SPV</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/04_4_vapor.html" target="_self">Vapor</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/04_5_gm.html" target="_self">GM</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/05_compile.html" target="_self">Compile</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/06_network.html" target="_self">Network</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/07_dashboard.html" target="_self">Dashboard</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/08_cli_guide.html" target="_self">Cli Guide</a></li><li style="height:216px;overflow:hidden" class="menu-item menu-item-level-2"><span>Mining<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/09_1_tensority.html" target="_self">Tensority</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/09_2_cpu.html" target="_self">CPU Mining</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/09_3_gpu.html" target="_self">GPU Mining</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/09_4_asic.html" target="_self">ASIC Mining</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/09_5_mining_pools.html" target="_self">Pool Mining</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>Tools<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/10_1_blockmeta.html" target="_self">Blockmeta</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/10_2_bytom_kit.html" target="_self">Bytom Kit</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/10_3_byone.html" target="_self">Byone</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/10_4_bytom_spanner.html" target="_self">Bytom Spanner</a></li></ul></li><li style="height:252px;overflow:hidden" class="menu-item menu-item-level-2"><span>Dev Guide<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/11_1_architecture.html" target="_self">Architecture</a></li><li class="menu-item menu-item-level-3"><a target="_self">Transaction</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/11_3_mnemonic.html" target="_self">Mnemonic</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/11_4_websocket.html" target="_self">Websocket Request</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/11_5_json_rpc.html" target="_self">JSON-RPC Request</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/11_6_sdk.html" target="_self">SDK</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>Smart Contract<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/12_1_equity.html" target="_self">Equity</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/12_2_smart_contract_build.html" target="_self">Smart Contract Build</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/12_3_contract_template.html" target="_self">Contract Template</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/12_4_contract_operator.html" target="_self">Contract Operator</a></li></ul></li><li style="height:72px;overflow:hidden" class="menu-item menu-item-level-2"><span>Docking Guide<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/13_1_mining_pool_docking_guide.html" target="_self">Mining Pool</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>Glossary<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/en-us/docs/14_1_transaction.html" target="_self">Transaction</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/14_2_address.html" target="_self">Address</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/14_3_account.html" target="_self">Account</a></li><li class="menu-item menu-item-level-3"><a href="/en-us/docs/14_4_block.html" target="_self">Block</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/15_error_code.html" target="_self">Error Code</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/16_faq.html" target="_self">FAQ</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/17_community.html" target="_self">Community</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>Mining Pool</h1>
<p><a name="53469cf0"></a></p>
<h1>How to build BTM pool</h1>
<p><a name="9dec8761"></a></p>
<h2><a href="https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#config-the-node"></a>config the node</h2>
<ul>
<li>when testing, could try switching to the<code>testnet</code>or<code>solonet</code>
<ul>
<li><code>./bytomd init --chain_id testnet</code></li>
<li>or <code>./bytomd init --chain_id solonet</code> , with a lower difficulty, in order to mine with cpu</li>
</ul>
</li>
<li>could use<code>-r &quot;your/directory&quot;</code>to specify the data directory when init with<code>init</code>or run with<code>node</code>
<ul>
<li>the directory will be created if not existed
<a name="procedure"></a></li>
</ul>
</li>
</ul>
<h2><a href="https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#procedure"></a>procedure</h2>
<ul>
<li>need to build an account and an addr immediately after u init the node, otherwise, the rewards will be sent to an empty addr</li>
<li>currently bytom doesn't support specifying the receive addr for rewards, and will use a same one by default</li>
<li><a href="https://github.com/Bytom/bytom/wiki/API-Reference">API doc</a></li>
<li>the pool<a href="https://github.com/Bytom/bytom/wiki/API-Reference#get-work-json"><code>/get-work-json</code></a>from a node
<ul>
<li>need to set-up mining address in advance, using <a href="https://github.com/Bytom/bytom/wiki/API-Reference#set-minining-address"><code>/set-minining-address</code></a></li>
</ul>
</li>
<li>send jobs to miners
<ul>
<li>as for the protocol,<a href="https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/STRATUM-BTM.md">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/STRATUM-BTM.md</a>can be helpful
<ul>
<li>a miner will only receive a job by<code>login</code>or by being notified by the pool
<ul>
<li>both use <code>submit</code> to submit</li>
<li>a miner will not <code>getjob</code> actively</li>
</ul>
</li>
</ul>
</li>
<li>a mock B3 miner:<a href="https://github.com/HAOYUatHZ/B3-Mimic/blob/master/main.go">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/main.go</a>
<ul>
<li><code>Version</code>, <code>Height</code>, <code>Timestamp</code>, <code>Bits</code> are little-endian</li>
<li>about<code>target</code>
<ul>
<li>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>var Diff1 = StringToBig(&quot;0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;)
func GetTargetHex(diff int64) string {
    padded := make([]byte, 32)
    diffBuff := new(big.Int).Div(Diff1, big.NewInt(diff)).Bytes()
    copy(padded[32-len(diffBuff):], diffBuff)
    buff := padded[0:4]
    targetHex := hex.EncodeToString(Reverse(buff))
    return targetHex
}
</code></pre>
<pre><code>  * targethex sent from the pool is target1（`0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF`） divided by the_poolDiff_, which is adjusted dynamically in order to ensure a miner submitting shares periodically, e.g., 3 times per minute
    * `ffff3f00` is corresponding to 1024，`c5a70000` is corresponding to 100001
</code></pre>
<ul>
<li>the pool need to validate the share
<ul>
<li>header_hash
<ul>
<li>can take advantage of <code>types.BlockHeader{}</code>'s <code>Hash()</code> in <code>&quot;github.com/bytom/protocol/bc/types&quot;</code> if using <em>golang</em></li>
<li><a href="https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/blhr_hash_V3.go">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/blhr_hash_V3.go</a> can be helpful if using other language</li>
</ul>
</li>
<li>then follow the_tensority_algo to calc the hash result
<ul>
<li>unfortunately the verification speeds of gonum version, cpp_openblas version, cpp_simd version are all too slow</li>
<li>a working pool has to use gpu
<ul>
<li><a href="https://github.com/Bytom/CppTensority">cpp tensority</a>, this repo also points out how to opt it using gpu</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>if a block is mined, the pool <a href="https://github.com/Bytom/bytom/wiki/API-Reference#submit-work-json"><code>/submit-work-json</code></a> to a node</li>
<li>retarget
<ul>
<li>see above, asjusted dynamically to make a miner submit 3 times / min
<a name="2609ad51"></a></li>
</ul>
</li>
</ul>
<h2><a href="https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#batch-tx"></a>batch tx</h2>
<ul>
<li>the addr for mainnet starts with<code>bm</code>
<ul>
<li>length:
<ul>
<li>normal: 42</li>
<li>mul-sig: 62</li>
</ul>
</li>
</ul>
</li>
<li>tool
<ul>
<li><a href="https://github.com/Bytom/bytom/tree/master/tools/sendbulktx">https://github.com/Bytom/bytom/tree/master/tools/sendbulktx</a></li>
</ul>
</li>
<li>a new addr for change will be generated each time</li>
</ul>
</div></section><footer class="footer-container"><div class="footer-body"><div class="copyright"><span>Copyright © 2019 Bytom</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>