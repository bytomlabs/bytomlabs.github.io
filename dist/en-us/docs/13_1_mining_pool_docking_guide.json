{
  "filename": "13_1_mining_pool_docking_guide.md",
  "__html": "<h1>Mining Pool</h1>\n<p><a name=\"53469cf0\"></a></p>\n<h1>How to build BTM pool</h1>\n<p><a name=\"9dec8761\"></a></p>\n<h2><a href=\"https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#config-the-node\"></a>config the node</h2>\n<ul>\n<li>when testing, could try switching to the<code>testnet</code>or<code>solonet</code>\n<ul>\n<li><code>./bytomd init --chain_id testnet</code></li>\n<li>or <code>./bytomd init --chain_id solonet</code> , with a lower difficulty, in order to mine with cpu</li>\n</ul>\n</li>\n<li>could use<code>-r &quot;your/directory&quot;</code>to specify the data directory when init with<code>init</code>or run with<code>node</code>\n<ul>\n<li>the directory will be created if not existed\n<a name=\"procedure\"></a></li>\n</ul>\n</li>\n</ul>\n<h2><a href=\"https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#procedure\"></a>procedure</h2>\n<ul>\n<li>need to build an account and an addr immediately after u init the node, otherwise, the rewards will be sent to an empty addr</li>\n<li>currently bytom doesn't support specifying the receive addr for rewards, and will use a same one by default</li>\n<li><a href=\"https://github.com/Bytom/bytom/wiki/API-Reference\">API doc</a></li>\n<li>the pool<a href=\"https://github.com/Bytom/bytom/wiki/API-Reference#get-work-json\"><code>/get-work-json</code></a>from a node\n<ul>\n<li>need to set-up mining address in advance, using <a href=\"https://github.com/Bytom/bytom/wiki/API-Reference#set-minining-address\"><code>/set-minining-address</code></a></li>\n</ul>\n</li>\n<li>send jobs to miners\n<ul>\n<li>as for the protocol,<a href=\"https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/STRATUM-BTM.md\">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/STRATUM-BTM.md</a>can be helpful\n<ul>\n<li>a miner will only receive a job by<code>login</code>or by being notified by the pool\n<ul>\n<li>both use <code>submit</code> to submit</li>\n<li>a miner will not <code>getjob</code> actively</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>a mock B3 miner:<a href=\"https://github.com/HAOYUatHZ/B3-Mimic/blob/master/main.go\">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/main.go</a>\n<ul>\n<li><code>Version</code>, <code>Height</code>, <code>Timestamp</code>, <code>Bits</code> are little-endian</li>\n<li>about<code>target</code>\n<ul>\n<li>.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<pre><code>var Diff1 = StringToBig(&quot;0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;)\nfunc GetTargetHex(diff int64) string {\n    padded := make([]byte, 32)\n    diffBuff := new(big.Int).Div(Diff1, big.NewInt(diff)).Bytes()\n    copy(padded[32-len(diffBuff):], diffBuff)\n    buff := padded[0:4]\n    targetHex := hex.EncodeToString(Reverse(buff))\n    return targetHex\n}\n</code></pre>\n<pre><code>  * targethex sent from the pool is target1（`0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF`） divided by the_poolDiff_, which is adjusted dynamically in order to ensure a miner submitting shares periodically, e.g., 3 times per minute\n    * `ffff3f00` is corresponding to 1024，`c5a70000` is corresponding to 100001\n</code></pre>\n<ul>\n<li>the pool need to validate the share\n<ul>\n<li>header_hash\n<ul>\n<li>can take advantage of <code>types.BlockHeader{}</code>'s <code>Hash()</code> in <code>&quot;github.com/bytom/protocol/bc/types&quot;</code> if using <em>golang</em></li>\n<li><a href=\"https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/blhr_hash_V3.go\">https://github.com/HAOYUatHZ/B3-Mimic/blob/master/docs/blhr_hash_V3.go</a> can be helpful if using other language</li>\n</ul>\n</li>\n<li>then follow the_tensority_algo to calc the hash result\n<ul>\n<li>unfortunately the verification speeds of gonum version, cpp_openblas version, cpp_simd version are all too slow</li>\n<li>a working pool has to use gpu\n<ul>\n<li><a href=\"https://github.com/Bytom/CppTensority\">cpp tensority</a>, this repo also points out how to opt it using gpu</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>if a block is mined, the pool <a href=\"https://github.com/Bytom/bytom/wiki/API-Reference#submit-work-json\"><code>/submit-work-json</code></a> to a node</li>\n<li>retarget\n<ul>\n<li>see above, asjusted dynamically to make a miner submit 3 times / min\n<a name=\"2609ad51\"></a></li>\n</ul>\n</li>\n</ul>\n<h2><a href=\"https://github.com/Bytom/bytom/wiki/How-to-build-BTM-pool#batch-tx\"></a>batch tx</h2>\n<ul>\n<li>the addr for mainnet starts with<code>bm</code>\n<ul>\n<li>length:\n<ul>\n<li>normal: 42</li>\n<li>mul-sig: 62</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>tool\n<ul>\n<li><a href=\"https://github.com/Bytom/bytom/tree/master/tools/sendbulktx\">https://github.com/Bytom/bytom/tree/master/tools/sendbulktx</a></li>\n</ul>\n</li>\n<li>a new addr for change will be generated each time</li>\n</ul>\n",
  "link": "/en-us/docs/13_1_mining_pool_docking_guide.html",
  "meta": {
    "title": "Mining Pool"
  }
}